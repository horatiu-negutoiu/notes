# Kubernetes / Deployments

Cheatsheet:
https://kubernetes.io/docs/reference/kubectl/cheatsheet/

## Creating Deployments

Create a deployment:
```
$ kubectl create deployment $DEPLOYMENT_NAME --image=$IMAGE_NAME

$ kubectl create deployment nginx-depl --image=nginx
```

Through `yaml` files, we define/control deployments, but there are 3 layers:
- deployments (L1), which manage...
- replica sets (L2), which manages...
- pods (L3)

```
# determine deployment status
$ kubectl get deployment

# determine replica set status
$ kubectl get replicaset

# determine pod status
$ kubectl get pod
```

Modifying the `yaml` deployment files, automatically destroys/updates/creates the new pods.

### Creating/Updating Deployment Files

Once a deployment file is created:
```
$ kubectl apply -f $DEPLOYMENT_FILE
```
Updating the file and re-running the command will automatically update the deployment.

## Debugging Pods

View logs generated by the pod:
```
kubectl logs $POD_ID
```

SSH into pod:
```
kubectl exec -it $POD_ID -- /bin/bash
```

Port-forward pod:
```
kubectl port-forward mongo-75f59d57f4-4nd6q 28015:27017

# or

kubectl port-forward pods/mongo-75f59d57f4-4nd6q 28015:27017
```

## Deleting Deployments

```
kubectl delete deployment $DEPLOYMENT_NAME
```
Everything else below that deployment will be removed automatically.
..but not always.
You can propagate and force the policy to delete dependents using:

```
kubectl delete replicaset my-repset --cascade=orphan
```

## Restarting Deployments

Manually restart the deployment:
```
kubectl rollout restart deployment [deployment_name]
```
